/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Observable, pipe, Subject, BehaviorSubject, } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import { Injectable, ApplicationRef, Inject, Optional } from '@angular/core';
import { SpeechRecognitionGrammars, SpeechRecognitionLang, SpeechRecognitionContinuous, SpeechRecognitionInterimResults, SpeechRecognitionMaxAlternatives, SpeechRecognitionServiceUri, } from './speech-recognition.token';
import { SpeechRecognitionCommon, } from './speech-recognition.common';
/** @type {?} */
const onType = (/**
 * @param {?} type
 * @return {?}
 */
(type) => {
    return filter((/**
     * @param {?} e
     * @return {?}
     */
    (e) => (e.type === type)));
});
const ɵ0 = onType;
/** @type {?} */
export const resultList = pipe(onType('result'), map((/**
 * @param {?} e
 * @return {?}
 */
(e) => e.results)));
export class RxSpeechRecognitionService extends SpeechRecognitionCommon {
    /**
     * @param {?} ref
     * @param {?} grammars
     * @param {?} lang
     * @param {?} continuous
     * @param {?} interimResults
     * @param {?} maxAlternatives
     * @param {?} serviceURI
     */
    constructor(ref, grammars, lang, continuous, interimResults, maxAlternatives, serviceURI) {
        super(grammars, lang, continuous, interimResults, maxAlternatives, serviceURI);
        this.ref = ref;
        this.proxy$ = new Subject();
        this._started$ = new BehaviorSubject(false);
        this.initInternal();
    }
    /**
     * @return {?}
     */
    get $() {
        return (/** @type {?} */ (this.proxy$));
    }
    /**
     * @return {?}
     */
    get started$() {
        return (/** @type {?} */ (this._started$));
    }
    /**
     * @private
     * @return {?}
     */
    initInternal() {
        // set handlers
        /** @type {?} */
        const handler = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.proxy$.next(e);
            this.ref.tick();
        });
        /** @type {?} */
        const errHandler = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.proxy$.error(e);
            this.ref.tick();
        });
        this.internal.onaudiostart = handler;
        this.internal.onsoundstart = handler;
        this.internal.onspeechstart = handler;
        this.internal.onspeechend = handler;
        this.internal.onsoundend = handler;
        this.internal.onaudioend = handler;
        this.internal.onresult = handler;
        this.internal.onnomatch = handler;
        this.internal.onerror = errHandler;
        this.internal.onstart = handler;
        this.internal.onend = handler;
        // see setter methods
        this.grammars = this._grammars;
        this.lang = this._lang;
        this.continuous = this._continuous;
        this.interimResults = this._interimResults;
        this.maxAlternatives = this._maxAlternatives;
        this.serviceURI = this._serviceURI;
        this.proxy$.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            switch (e.type) {
                case 'start':
                    this._started$.next(true);
                    break;
                case 'end':
                    this._started$.next(false);
                    break;
            }
        }));
    }
    // The listen() method aims to recognize the grammar associated with the current SpeechRecognition,
    // Observable is returned for handling voice recognition service listening to incoming voice.
    // When you subscrive the return value, listening begins and listening ends when an end event occurs.
    // Interrupt listening by unsubscribing in the middle.
    //
    // listen() メソッドは、現在のSpeechRecognitionに
    // 関連付けられた文法を認識することを目的として、
    // 着信音声を聴取する音声認識サービスを扱うためのObservableが返されます。
    // 返り値をsubscriveすると聴取が開始され、endのイベントが発生すると聴取を終了します。
    // 途中でunsbscriveすることで聴取を中断します。
    /**
     * @return {?}
     */
    listen() {
        /** @type {?} */
        const listener = new Observable((/**
         * @param {?} ovserver
         * @return {?}
         */
        (ovserver) => {
            // create subscriotion
            /** @type {?} */
            const subscriotion = this.proxy$.subscribe({
                next: (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    ovserver.next(e);
                    if (e.type && e.type === 'end') {
                        this.internal.stop();
                        ovserver.complete();
                        subscriotion.unsubscribe();
                    }
                }),
                error: (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => ovserver.error(e)),
            });
            // Speech Recognition start
            this.internal.start();
            return (/**
             * @return {?}
             */
            () => {
                this.internal.abort();
                subscriotion.unsubscribe();
            });
        }));
        return listener;
    }
}
RxSpeechRecognitionService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
RxSpeechRecognitionService.ctorParameters = () => [
    { type: ApplicationRef },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionGrammars,] }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionLang,] }] },
    { type: Boolean, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionContinuous,] }] },
    { type: Boolean, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionInterimResults,] }] },
    { type: Number, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionMaxAlternatives,] }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionServiceUri,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype.proxy$;
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype._started$;
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype.ref;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicngtc3BlZWNoLXJlY29nbml0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Aa2FtaWF6eWEvbmd4LXNwZWVjaC1yZWNvZ25pdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL3J4LXNwZWVjaC1yZWNvZ25pdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsVUFBVSxFQUNWLElBQUksRUFFSixPQUFPLEVBQ1AsZUFBZSxHQUNoQixNQUFNLE1BQU0sQ0FBQztBQUNkLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU3RSxPQUFPLEVBQ0wseUJBQXlCLEVBQ3pCLHFCQUFxQixFQUNyQiwyQkFBMkIsRUFDM0IsK0JBQStCLEVBQy9CLGdDQUFnQyxFQUNoQywyQkFBMkIsR0FDNUIsTUFBTSw0QkFBNEIsQ0FBQztBQU9wQyxPQUFPLEVBQ0wsdUJBQXVCLEdBQ3hCLE1BQU0sNkJBQTZCLENBQUM7O01BRS9CLE1BQU07Ozs7QUFBRyxDQUFDLElBQVksRUFBRSxFQUFFO0lBQzlCLE9BQU8sTUFBTTs7OztJQUFDLENBQUMsQ0FBZ0MsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxFQUFDLENBQUM7QUFDekUsQ0FBQyxDQUFBOzs7QUFFRCxNQUFNLE9BQU8sVUFBVSxHQUErRixJQUFJLENBQ3hILE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFDaEIsR0FBRzs7OztBQUFDLENBQUMsQ0FBeUIsRUFBK0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUMsQ0FDM0U7QUFHRCxNQUFNLE9BQU8sMEJBQTJCLFNBQVEsdUJBQXVCOzs7Ozs7Ozs7O0lBY3JFLFlBQ1UsR0FBbUIsRUFHM0IsUUFBK0Is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QVEsWUFBSSxNQUFNLFNBQUMsZ0NBQWdDO3lDQUduRCxRQUFRLFlBQUksTUFBTSxTQUFDLDJCQUEyQjs7Ozs7OztJQTlCakQsNENBQXVFOzs7OztJQUV2RSwrQ0FBd0Q7Ozs7O0lBV3RELHlDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIE9ic2VydmFibGUsXG4gIHBpcGUsXG4gIFVuYXJ5RnVuY3Rpb24sXG4gIFN1YmplY3QsXG4gIEJlaGF2aW9yU3ViamVjdCxcbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgQXBwbGljYXRpb25SZWYsIEluamVjdCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgU3BlZWNoUmVjb2duaXRpb25HcmFtbWFycyxcbiAgU3BlZWNoUmVjb2duaXRpb25MYW5nLFxuICBTcGVlY2hSZWNvZ25pdGlvbkNvbnRpbnVvdXMsXG4gIFNwZWVjaFJlY29nbml0aW9uSW50ZXJpbVJlc3VsdHMsXG4gIFNwZWVjaFJlY29nbml0aW9uTWF4QWx0ZXJuYXRpdmVzLFxuICBTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VVcmksXG59IGZyb20gJy4vc3BlZWNoLXJlY29nbml0aW9uLnRva2VuJztcblxuaW1wb3J0IHtcbiAgU3BlZWNoR3JhbW1hckxpc3RUeXBlLFxuICBTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudCxcbn0gZnJvbSAnLi4vYWRhcHRlcic7XG5cbmltcG9ydCB7XG4gIFNwZWVjaFJlY29nbml0aW9uQ29tbW9uLFxufSBmcm9tICcuL3NwZWVjaC1yZWNvZ25pdGlvbi5jb21tb24nO1xuXG5jb25zdCBvblR5cGUgPSAodHlwZTogc3RyaW5nKSA9PiB7XG4gIHJldHVybiBmaWx0ZXIoKGU6IFNwZWVjaFJlY29nbml0aW9uU2VydmljZUV2ZW50KSA9PiAoZS50eXBlID09PSB0eXBlKSk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVzdWx0TGlzdDogVW5hcnlGdW5jdGlvbjxPYnNlcnZhYmxlPFNwZWVjaFJlY29nbml0aW9uRXZlbnQ+LCBPYnNlcnZhYmxlPFNwZWVjaFJlY29nbml0aW9uUmVzdWx0TGlzdD4+ID0gcGlwZShcbiAgb25UeXBlKCdyZXN1bHQnKSxcbiAgbWFwKChlOiBTcGVlY2hSZWNvZ25pdGlvbkV2ZW50KTogU3BlZWNoUmVjb2duaXRpb25SZXN1bHRMaXN0ID0+IGUucmVzdWx0cyksXG4pO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUnhTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2UgZXh0ZW5kcyBTcGVlY2hSZWNvZ25pdGlvbkNvbW1vbiB7XG5cbiAgcHJpdmF0ZSBwcm94eSQ6IFN1YmplY3Q8U3BlZWNoUmVjb2duaXRpb25TZXJ2aWNlRXZlbnQ+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwcml2YXRlIF9zdGFydGVkJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIGdldCAkKCk6IE9ic2VydmFibGU8U3BlZWNoUmVjb2duaXRpb25TZXJ2aWNlRXZlbnQ+IHtcbiAgICByZXR1cm4gdGhpcy5wcm94eSQgYXMgT2JzZXJ2YWJsZTxTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudD47XG4gIH1cblxuICBnZXQgc3RhcnRlZCQoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXJ0ZWQkIGFzIE9ic2VydmFibGU8Ym9vbGVhbj47XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlZjogQXBwbGljYXRpb25SZWYsXG5cbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFNwZWVjaFJlY29nbml0aW9uR3JhbW1hcnMpXG4gICAgZ3JhbW1hcnM6IFNwZWVjaEdyYW1tYXJMaXN0VHlwZSxcblxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU3BlZWNoUmVjb2duaXRpb25MYW5nKVxuICAgIGxhbmc6IHN0cmluZyxcblxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU3BlZWNoUmVjb2duaXRpb25Db250aW51b3VzKVxuICAgIGNvbnRpbnVvdXM6IGJvb2xlYW4sXG5cbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFNwZWVjaFJlY29nbml0aW9uSW50ZXJpbVJlc3VsdHMpXG4gICAgaW50ZXJpbVJlc3VsdHM6IGJvb2xlYW4sXG5cbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFNwZWVjaFJlY29nbml0aW9uTWF4QWx0ZXJuYXRpdmVzKVxuICAgIG1heEFsdGVybmF0aXZlczogbnVtYmVyLFxuXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VVcmkpXG4gICAgc2VydmljZVVSSTogc3RyaW5nLFxuICApIHtcbiAgICBzdXBlcihncmFtbWFycywgbGFuZywgY29udGludW91cywgaW50ZXJpbVJlc3VsdHMsIG1heEFsdGVybmF0aXZlcywgc2VydmljZVVSSSk7XG4gICAgdGhpcy5pbml0SW50ZXJuYWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdEludGVybmFsKCkge1xuICAgIC8vIHNldCBoYW5kbGVyc1xuICAgIGNvbnN0IGhhbmRsZXIgPSAoZSkgPT4ge1xuICAgICAgdGhpcy5wcm94eSQubmV4dChlKTtcbiAgICAgIHRoaXMucmVmLnRpY2soKTtcbiAgICB9O1xuICAgIGNvbnN0IGVyckhhbmRsZXIgPSAoZSkgPT4ge1xuICAgICAgdGhpcy5wcm94eSQuZXJyb3IoZSk7XG4gICAgICB0aGlzLnJlZi50aWNrKCk7XG4gICAgfTtcbiAgICB0aGlzLmludGVybmFsLm9uYXVkaW9zdGFydCA9IGhhbmRsZXI7XG4gICAgdGhpcy5pbnRlcm5hbC5vbnNvdW5kc3RhcnQgPSBoYW5kbGVyO1xuICAgIHRoaXMuaW50ZXJuYWwub25zcGVlY2hzdGFydCA9IGhhbmRsZXI7XG5cbiAgICB0aGlzLmludGVybmFsLm9uc3BlZWNoZW5kID0gaGFuZGxlcjtcbiAgICB0aGlzLmludGVybmFsLm9uc291bmRlbmQgPSBoYW5kbGVyO1xuICAgIHRoaXMuaW50ZXJuYWwub25hdWRpb2VuZCA9IGhhbmRsZXI7XG5cbiAgICB0aGlzLmludGVybmFsLm9ucmVzdWx0ID0gaGFuZGxlcjtcbiAgICB0aGlzLmludGVybmFsLm9ubm9tYXRjaCA9IGhhbmRsZXI7XG4gICAgdGhpcy5pbnRlcm5hbC5vbmVycm9yID0gZXJySGFuZGxlcjtcblxuICAgIHRoaXMuaW50ZXJuYWwub25zdGFydCA9IGhhbmRsZXI7XG4gICAgdGhpcy5pbnRlcm5hbC5vbmVuZCA9IGhhbmRsZXI7XG5cbiAgICAvLyBzZWUgc2V0dGVyIG1ldGhvZHNcbiAgICB0aGlzLmdyYW1tYXJzID0gdGhpcy5fZ3JhbW1hcnM7XG4gICAgdGhpcy5sYW5nID0gdGhpcy5fbGFuZztcbiAgICB0aGlzLmNvbnRpbnVvdXMgPSB0aGlzLl9jb250aW51b3VzO1xuICAgIHRoaXMuaW50ZXJpbVJlc3VsdHMgPSB0aGlzLl9pbnRlcmltUmVzdWx0cztcbiAgICB0aGlzLm1heEFsdGVybmF0aXZlcyA9IHRoaXMuX21heEFsdGVybmF0aXZlcztcbiAgICB0aGlzLnNlcnZpY2VVUkkgPSB0aGlzLl9zZXJ2aWNlVVJJO1xuXG4gICAgdGhpcy5wcm94eSQuc3Vic2NyaWJlKChlKSA9PiB7XG4gICAgICBzd2l0Y2ggKGUudHlwZSkge1xuICAgICAgICBjYXNlICdzdGFydCc6XG4gICAgICAgICAgdGhpcy5fc3RhcnRlZCQubmV4dCh0cnVlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgICB0aGlzLl9zdGFydGVkJC5uZXh0KGZhbHNlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRoZSBsaXN0ZW4oKSBtZXRob2QgYWltcyB0byByZWNvZ25pemUgdGhlIGdyYW1tYXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBjdXJyZW50IFNwZWVjaFJlY29nbml0aW9uLFxuICAvLyBPYnNlcnZhYmxlIGlzIHJldHVybmVkIGZvciBoYW5kbGluZyB2b2ljZSByZWNvZ25pdGlvbiBzZXJ2aWNlIGxpc3RlbmluZyB0byBpbmNvbWluZyB2b2ljZS5cbiAgLy8gV2hlbiB5b3Ugc3Vic2NyaXZlIHRoZSByZXR1cm4gdmFsdWUsIGxpc3RlbmluZyBiZWdpbnMgYW5kIGxpc3RlbmluZyBlbmRzIHdoZW4gYW4gZW5kIGV2ZW50IG9jY3Vycy5cbiAgLy8gSW50ZXJydXB0IGxpc3RlbmluZyBieSB1bnN1YnNjcmliaW5nIGluIHRoZSBtaWRkbGUuXG4gIC8vXG4gIC8vIGxpc3RlbigpIOODoeOCveODg+ODieOBr+OAgeePvuWcqOOBrlNwZWVjaFJlY29nbml0aW9u44GrXG4gIC8vIOmWoumAo+S7mOOBkeOCieOCjOOBn+aWh+azleOCkuiqjeitmOOBmeOCi+OBk+OBqOOCkuebrueahOOBqOOBl+OBpuOAgVxuICAvLyDnnYDkv6Hpn7Plo7DjgpLogbTlj5bjgZnjgovpn7Plo7Doqo3orZjjgrXjg7zjg5PjgrnjgpLmibHjgYbjgZ/jgoHjga5PYnNlcnZhYmxl44GM6L+U44GV44KM44G+44GZ44CCXG4gIC8vIOi/lOOCiuWApOOCknN1YnNjcml2ZeOBmeOCi+OBqOiBtOWPluOBjOmWi+Wni+OBleOCjOOAgWVuZOOBruOCpOODmeODs+ODiOOBjOeZuueUn+OBmeOCi+OBqOiBtOWPluOCkue1guS6huOBl+OBvuOBmeOAglxuICAvLyDpgJTkuK3jgad1bnNic2NyaXZl44GZ44KL44GT44Go44Gn6IG05Y+W44KS5Lit5pat44GX44G+44GZ44CCXG4gIHB1YmxpYyBsaXN0ZW4oKTogT2JzZXJ2YWJsZTxTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudD4ge1xuXG4gICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgT2JzZXJ2YWJsZTxTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudD4oKG92c2VydmVyKSA9PiB7XG4gICAgICAvLyBjcmVhdGUgc3Vic2NyaW90aW9uXG4gICAgICBjb25zdCBzdWJzY3Jpb3Rpb24gPSB0aGlzLnByb3h5JC5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoZSkgPT4ge1xuICAgICAgICAgIG92c2VydmVyLm5leHQoZSk7XG5cbiAgICAgICAgICBpZiAoZS50eXBlICYmIGUudHlwZSA9PT0gJ2VuZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWwuc3RvcCgpO1xuICAgICAgICAgICAgb3ZzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgIHN1YnNjcmlvdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlKSA9PiBvdnNlcnZlci5lcnJvcihlKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTcGVlY2ggUmVjb2duaXRpb24gc3RhcnRcbiAgICAgIHRoaXMuaW50ZXJuYWwuc3RhcnQoKTtcblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbC5hYm9ydCgpO1xuICAgICAgICBzdWJzY3Jpb3Rpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbGlzdGVuZXI7XG4gIH1cblxufVxuIl19