/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Observable, pipe, Subject, BehaviorSubject, } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import { Injectable, ApplicationRef, Inject, Optional } from '@angular/core';
import { SpeechRecognitionGrammars, SpeechRecognitionLang, SpeechRecognitionContinuous, SpeechRecognitionInterimResults, SpeechRecognitionMaxAlternatives, SpeechRecognitionServiceUri, } from './speech-recognition.token';
import { SpeechRecognitionCommon, } from './speech-recognition.common';
/** @type {?} */
var onType = (/**
 * @param {?} type
 * @return {?}
 */
function (type) {
    return filter((/**
     * @param {?} e
     * @return {?}
     */
    function (e) { return (e.type === type); }));
});
var ɵ0 = onType;
/** @type {?} */
export var resultList = pipe(onType('result'), map((/**
 * @param {?} e
 * @return {?}
 */
function (e) { return e.results; })));
var RxSpeechRecognitionService = /** @class */ (function (_super) {
    tslib_1.__extends(RxSpeechRecognitionService, _super);
    function RxSpeechRecognitionService(ref, grammars, lang, continuous, interimResults, maxAlternatives, serviceURI) {
        var _this = _super.call(this, grammars, lang, continuous, interimResults, maxAlternatives, serviceURI) || this;
        _this.ref = ref;
        _this.proxy$ = new Subject();
        _this._started$ = new BehaviorSubject(false);
        _this.initInternal();
        return _this;
    }
    Object.defineProperty(RxSpeechRecognitionService.prototype, "$", {
        get: /**
         * @return {?}
         */
        function () {
            return (/** @type {?} */ (this.proxy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxSpeechRecognitionService.prototype, "started$", {
        get: /**
         * @return {?}
         */
        function () {
            return (/** @type {?} */ (this._started$));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @return {?}
     */
    RxSpeechRecognitionService.prototype.initInternal = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // set handlers
        /** @type {?} */
        var handler = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.proxy$.next(e);
            _this.ref.tick();
        });
        /** @type {?} */
        var errHandler = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.proxy$.error(e);
            _this.ref.tick();
        });
        this.internal.onaudiostart = handler;
        this.internal.onsoundstart = handler;
        this.internal.onspeechstart = handler;
        this.internal.onspeechend = handler;
        this.internal.onsoundend = handler;
        this.internal.onaudioend = handler;
        this.internal.onresult = handler;
        this.internal.onnomatch = handler;
        this.internal.onerror = errHandler;
        this.internal.onstart = handler;
        this.internal.onend = handler;
        // see setter methods
        this.grammars = this._grammars;
        this.lang = this._lang;
        this.continuous = this._continuous;
        this.interimResults = this._interimResults;
        this.maxAlternatives = this._maxAlternatives;
        this.serviceURI = this._serviceURI;
        this.proxy$.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            switch (e.type) {
                case 'start':
                    _this._started$.next(true);
                    break;
                case 'end':
                    _this._started$.next(false);
                    break;
            }
        }));
    };
    // The listen() method aims to recognize the grammar associated with the current SpeechRecognition,
    // Observable is returned for handling voice recognition service listening to incoming voice.
    // When you subscrive the return value, listening begins and listening ends when an end event occurs.
    // Interrupt listening by unsubscribing in the middle.
    //
    // listen() メソッドは、現在のSpeechRecognitionに
    // 関連付けられた文法を認識することを目的として、
    // 着信音声を聴取する音声認識サービスを扱うためのObservableが返されます。
    // 返り値をsubscriveすると聴取が開始され、endのイベントが発生すると聴取を終了します。
    // 途中でunsbscriveすることで聴取を中断します。
    // The listen() method aims to recognize the grammar associated with the current SpeechRecognition,
    // Observable is returned for handling voice recognition service listening to incoming voice.
    // When you subscrive the return value, listening begins and listening ends when an end event occurs.
    // Interrupt listening by unsubscribing in the middle.
    //
    // listen() メソッドは、現在のSpeechRecognitionに
    // 関連付けられた文法を認識することを目的として、
    // 着信音声を聴取する音声認識サービスを扱うためのObservableが返されます。
    // 返り値をsubscriveすると聴取が開始され、endのイベントが発生すると聴取を終了します。
    // 途中でunsbscriveすることで聴取を中断します。
    /**
     * @return {?}
     */
    RxSpeechRecognitionService.prototype.listen = 
    // The listen() method aims to recognize the grammar associated with the current SpeechRecognition,
    // Observable is returned for handling voice recognition service listening to incoming voice.
    // When you subscrive the return value, listening begins and listening ends when an end event occurs.
    // Interrupt listening by unsubscribing in the middle.
    //
    // listen() メソッドは、現在のSpeechRecognitionに
    // 関連付けられた文法を認識することを目的として、
    // 着信音声を聴取する音声認識サービスを扱うためのObservableが返されます。
    // 返り値をsubscriveすると聴取が開始され、endのイベントが発生すると聴取を終了します。
    // 途中でunsbscriveすることで聴取を中断します。
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var listener = new Observable((/**
         * @param {?} ovserver
         * @return {?}
         */
        function (ovserver) {
            // create subscriotion
            /** @type {?} */
            var subscriotion = _this.proxy$.subscribe({
                next: (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    ovserver.next(e);
                    if (e.type && e.type === 'end') {
                        _this.internal.stop();
                        ovserver.complete();
                        subscriotion.unsubscribe();
                    }
                }),
                error: (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) { return ovserver.error(e); }),
            });
            // Speech Recognition start
            _this.internal.start();
            return (/**
             * @return {?}
             */
            function () {
                _this.internal.abort();
                subscriotion.unsubscribe();
            });
        }));
        return listener;
    };
    RxSpeechRecognitionService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    RxSpeechRecognitionService.ctorParameters = function () { return [
        { type: ApplicationRef },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionGrammars,] }] },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionLang,] }] },
        { type: Boolean, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionContinuous,] }] },
        { type: Boolean, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionInterimResults,] }] },
        { type: Number, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionMaxAlternatives,] }] },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SpeechRecognitionServiceUri,] }] }
    ]; };
    return RxSpeechRecognitionService;
}(SpeechRecognitionCommon));
export { RxSpeechRecognitionService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype.proxy$;
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype._started$;
    /**
     * @type {?}
     * @private
     */
    RxSpeechRecognitionService.prototype.ref;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicngtc3BlZWNoLXJlY29nbml0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Aa2FtaWF6eWEvbmd4LXNwZWVjaC1yZWNvZ25pdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL3J4LXNwZWVjaC1yZWNvZ25pdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFVBQVUsRUFDVixJQUFJLEVBRUosT0FBTyxFQUNQLGVBQWUsR0FDaEIsTUFBTSxNQUFNLENBQUM7QUFDZCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFN0UsT0FBTyxFQUNMLHlCQUF5QixFQUN6QixxQkFBcUIsRUFDckIsMkJBQTJCLEVBQzNCLCtCQUErQixFQUMvQixnQ0FBZ0MsRUFDaEMsMkJBQTJCLEdBQzVCLE1BQU0sNEJBQTRCLENBQUM7QUFPcEMsT0FBTyxFQUNMLHVCQUF1QixHQUN4QixNQUFNLDZCQUE2QixDQUFDOztJQUUvQixNQUFNOzs7O0FBQUcsVUFBQyxJQUFZO0lBQzFCLE9BQU8sTUFBTTs7OztJQUFDLFVBQUMsQ0FBZ0MsSUFBSyxPQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsRUFBakIsQ0FBaUIsRUFBQyxDQUFDO0FBQ3pFLENBQUMsQ0FBQTs7O0FBRUQsTUFBTSxLQUFPLFVBQVUsR0FBK0YsSUFBSSxDQUN4SCxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQ2hCLEdBQUc7Ozs7QUFBQyxVQUFDLENBQXlCLElBQWtDLE9BQUEsQ0FBQyxDQUFDLE9BQU8sRUFBVCxDQUFTLEVBQUMsQ0FDM0U7QUFFRDtJQUNnRCxzREFBdUI7SUFjckUsb0NBQ1UsR0FBbUIsRUFHM0IsUUFBK0IsRUFHL0IsSUFBWSxFQUdaLFVBQW1C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OUIsUUFBUSxZQUFJLE1BQU0sU0FBQyx5QkFBeUI7NkNBRzVDLFFBQVEsWUFBSSxNQUFNLFNBQUMscUJBQXFCOzhDQUd4QyxRQUFRLFlBQUksTUFBTSxTQUFDLDJCQUEyQjs4Q0FHOUMsUUFBUSxZQUFJLE1BQU0sU0FBQywrQkFBK0I7NkNBR2xELFFBQVEsWUFBSSxNQUFNLFNBQUMsZ0NBQWdDOzZDQUduRCxRQUFRLFlBQUksTUFBTSxTQUFDLDJCQUEyQjs7SUEyRm5ELGlDQUFDO0NBQUEsQUE1SEQsQ0FDZ0QsdUJBQXVCLEdBMkh0RTtTQTNIWSwwQkFBMEI7Ozs7OztJQUVyQyw0Q0FBdUU7Ozs7O0lBRXZFLCtDQUF3RDs7Ozs7SUFXdEQseUNBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgT2JzZXJ2YWJsZSxcbiAgcGlwZSxcbiAgVW5hcnlGdW5jdGlvbixcbiAgU3ViamVjdCxcbiAgQmVoYXZpb3JTdWJqZWN0LFxufSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBBcHBsaWNhdGlvblJlZiwgSW5qZWN0LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICBTcGVlY2hSZWNvZ25pdGlvbkdyYW1tYXJzLFxuICBTcGVlY2hSZWNvZ25pdGlvbkxhbmcsXG4gIFNwZWVjaFJlY29nbml0aW9uQ29udGludW91cyxcbiAgU3BlZWNoUmVjb2duaXRpb25JbnRlcmltUmVzdWx0cyxcbiAgU3BlZWNoUmVjb2duaXRpb25NYXhBbHRlcm5hdGl2ZXMsXG4gIFNwZWVjaFJlY29nbml0aW9uU2VydmljZVVyaSxcbn0gZnJvbSAnLi9zcGVlY2gtcmVjb2duaXRpb24udG9rZW4nO1xuXG5pbXBvcnQge1xuICBTcGVlY2hHcmFtbWFyTGlzdFR5cGUsXG4gIFNwZWVjaFJlY29nbml0aW9uU2VydmljZUV2ZW50LFxufSBmcm9tICcuLi9hZGFwdGVyJztcblxuaW1wb3J0IHtcbiAgU3BlZWNoUmVjb2duaXRpb25Db21tb24sXG59IGZyb20gJy4vc3BlZWNoLXJlY29nbml0aW9uLmNvbW1vbic7XG5cbmNvbnN0IG9uVHlwZSA9ICh0eXBlOiBzdHJpbmcpID0+IHtcbiAgcmV0dXJuIGZpbHRlcigoZTogU3BlZWNoUmVjb2duaXRpb25TZXJ2aWNlRXZlbnQpID0+IChlLnR5cGUgPT09IHR5cGUpKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXN1bHRMaXN0OiBVbmFyeUZ1bmN0aW9uPE9ic2VydmFibGU8U3BlZWNoUmVjb2duaXRpb25FdmVudD4sIE9ic2VydmFibGU8U3BlZWNoUmVjb2duaXRpb25SZXN1bHRMaXN0Pj4gPSBwaXBlKFxuICBvblR5cGUoJ3Jlc3VsdCcpLFxuICBtYXAoKGU6IFNwZWVjaFJlY29nbml0aW9uRXZlbnQpOiBTcGVlY2hSZWNvZ25pdGlvblJlc3VsdExpc3QgPT4gZS5yZXN1bHRzKSxcbik7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSeFNwZWVjaFJlY29nbml0aW9uU2VydmljZSBleHRlbmRzIFNwZWVjaFJlY29nbml0aW9uQ29tbW9uIHtcblxuICBwcml2YXRlIHByb3h5JDogU3ViamVjdDxTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudD4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHByaXZhdGUgX3N0YXJ0ZWQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG5cbiAgZ2V0ICQoKTogT2JzZXJ2YWJsZTxTcGVlY2hSZWNvZ25pdGlvblNlcnZpY2VFdmVudD4ge1xuICAgIHJldHVybiB0aGlzLnByb3h5JCBhcyBPYnNlcnZhYmxlPFNwZWVjaFJlY29nbml0aW9uU2VydmljZUV2ZW50PjtcbiAgfVxuXG4gIGdldCBzdGFydGVkJCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhcnRlZCQgYXMgT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVmOiBBcHBsaWNhdGlvblJlZixcblxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU3BlZWNoUmVjb2duaXRpb25HcmFtbWFycylcbiAgICBncmFtbWFyczogU3BlZWNoR3JhbW1hckxpc3RUeXBlLFxuXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChTcGVlY2hSZWNvZ25pdGlvbkxhbmcpXG4gICAgbGFuZzogc3RyaW5nLFxuXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChTcGVlY2hSZWNvZ25pdGlvbkNvbnRpbnVvdXMpXG4gICAgY29udGludW91czogYm9vbGVhbixcblxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU3BlZWNoUmVjb2duaXRpb25JbnRlcmltUmVzdWx0cylcbiAgICBpbnRlcmltUmVzdWx0czogYm9vbGVhbixcblxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU3BlZWNoUmVjb2duaXRpb25NYXhBbHRlcm5hdGl2ZXMpXG4gICAgbWF4QWx0ZXJuYXRpdmVzOiBudW1iZXIsXG5cbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFNwZWVjaFJlY29nbml0aW9uU2VydmljZVVyaSlcbiAgICBzZXJ2aWNlVVJJOiBzdHJpbmcsXG4gICkge1xuICAgIHN1cGVyKGdyYW1tYXJzLCBsYW5nLCBjb250aW51b3VzLCBpbnRlcmltUmVzdWx0cywgbWF4QWx0ZXJuYXRpdmVzLCBzZXJ2aWNlVVJJKTtcbiAgICB0aGlzLmluaXRJbnRlcm5hbCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0SW50ZXJuYWwoKSB7XG4gICAgLy8gc2V0IGhhbmRsZXJzXG4gICAgY29uc3QgaGFuZGxlciA9IChlKSA9PiB7XG4gICAgICB0aGlzLnByb3h5JC5uZXh0KGUpO1xuICAgICAgdGhpcy5yZWYudGljaygpO1xuICAgIH07XG4gICAgY29uc3QgZXJySGFuZGxlciA9IChlKSA9PiB7XG4gICAgICB0aGlzLnByb3h5JC5lcnJvcihlKTtcbiAgICAgIHRoaXMucmVmLnRpY2soKTtcbiAgICB9O1xuICAgIHRoaXMuaW50ZXJuYWwub25hdWRpb3N0YXJ0ID0gaGFuZGxlcjtcbiAgICB0aGlzLmludGVybmFsLm9uc291bmRzdGFydCA9IGhhbmRsZXI7XG4gICAgdGhpcy5pbnRlcm5hbC5vbnNwZWVjaHN0YXJ0ID0gaGFuZGxlcjtcblxuICAgIHRoaXMuaW50ZXJuYWwub25zcGVlY2hlbmQgPSBoYW5kbGVyO1xuICAgIHRoaXMuaW50ZXJuYWwub25zb3VuZGVuZCA9IGhhbmRsZXI7XG4gICAgdGhpcy5pbnRlcm5hbC5vbmF1ZGlvZW5kID0gaGFuZGxlcjtcblxuICAgIHRoaXMuaW50ZXJuYWwub25yZXN1bHQgPSBoYW5kbGVyO1xuICAgIHRoaXMuaW50ZXJuYWwub25ub21hdGNoID0gaGFuZGxlcjtcbiAgICB0aGlzLmludGVybmFsLm9uZXJyb3IgPSBlcnJIYW5kbGVyO1xuXG4gICAgdGhpcy5pbnRlcm5hbC5vbnN0YXJ0ID0gaGFuZGxlcjtcbiAgICB0aGlzLmludGVybmFsLm9uZW5kID0gaGFuZGxlcjtcblxuICAgIC8vIHNlZSBzZXR0ZXIgbWV0aG9kc1xuICAgIHRoaXMuZ3JhbW1hcnMgPSB0aGlzLl9ncmFtbWFycztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLl9sYW5nO1xuICAgIHRoaXMuY29udGludW91cyA9IHRoaXMuX2NvbnRpbnVvdXM7XG4gICAgdGhpcy5pbnRlcmltUmVzdWx0cyA9IHRoaXMuX2ludGVyaW1SZXN1bHRzO1xuICAgIHRoaXMubWF4QWx0ZXJuYXRpdmVzID0gdGhpcy5fbWF4QWx0ZXJuYXRpdmVzO1xuICAgIHRoaXMuc2VydmljZVVSSSA9IHRoaXMuX3NlcnZpY2VVUkk7XG5cbiAgICB0aGlzLnByb3h5JC5zdWJzY3JpYmUoKGUpID0+IHtcbiAgICAgIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgICB0aGlzLl9zdGFydGVkJC5uZXh0KHRydWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdlbmQnOlxuICAgICAgICAgIHRoaXMuX3N0YXJ0ZWQkLm5leHQoZmFsc2UpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gVGhlIGxpc3RlbigpIG1ldGhvZCBhaW1zIHRvIHJlY29nbml6ZSB0aGUgZ3JhbW1hciBhc3NvY2lhdGVkIHdpdGggdGhlIGN1cnJlbnQgU3BlZWNoUmVjb2duaXRpb24sXG4gIC8vIE9ic2VydmFibGUgaXMgcmV0dXJuZWQgZm9yIGhhbmRsaW5nIHZvaWNlIHJlY29nbml0aW9uIHNlcnZpY2UgbGlzdGVuaW5nIHRvIGluY29taW5nIHZvaWNlLlxuICAvLyBXaGVuIHlvdSBzdWJzY3JpdmUgdGhlIHJldHVybiB2YWx1ZSwgbGlzdGVuaW5nIGJlZ2lucyBhbmQgbGlzdGVuaW5nIGVuZHMgd2hlbiBhbiBlbmQgZXZlbnQgb2NjdXJzLlxuICAvLyBJbnRlcnJ1cHQgbGlzdGVuaW5nIGJ5IHVuc3Vic2NyaWJpbmcgaW4gdGhlIG1pZGRsZS5cbiAgLy9cbiAgLy8gbGlzdGVuKCkg44Oh44K944OD44OJ44Gv44CB54++5Zyo44GuU3BlZWNoUmVjb2duaXRpb27jgatcbiAgLy8g6Zai6YCj5LuY44GR44KJ44KM44Gf5paH5rOV44KS6KqN6K2Y44GZ44KL44GT44Go44KS55uu55qE44Go44GX44Gm44CBXG4gIC8vIOedgOS/oemfs+WjsOOCkuiBtOWPluOBmeOCi+mfs+WjsOiqjeitmOOCteODvOODk+OCueOCkuaJseOBhuOBn+OCgeOBrk9ic2VydmFibGXjgYzov5TjgZXjgozjgb7jgZnjgIJcbiAgLy8g6L+U44KK5YCk44KSc3Vic2NyaXZl44GZ44KL44Go6IG05Y+W44GM6ZaL5aeL44GV44KM44CBZW5k44Gu44Kk44OZ44Oz44OI44GM55m655Sf44GZ44KL44Go6IG05Y+W44KS57WC5LqG44GX44G+44GZ44CCXG4gIC8vIOmAlOS4reOBp3Vuc2JzY3JpdmXjgZnjgovjgZPjgajjgafogbTlj5bjgpLkuK3mlq3jgZfjgb7jgZnjgIJcbiAgcHVibGljIGxpc3RlbigpOiBPYnNlcnZhYmxlPFNwZWVjaFJlY29nbml0aW9uU2VydmljZUV2ZW50PiB7XG5cbiAgICBjb25zdCBsaXN0ZW5lciA9IG5ldyBPYnNlcnZhYmxlPFNwZWVjaFJlY29nbml0aW9uU2VydmljZUV2ZW50Pigob3ZzZXJ2ZXIpID0+IHtcbiAgICAgIC8vIGNyZWF0ZSBzdWJzY3Jpb3Rpb25cbiAgICAgIGNvbnN0IHN1YnNjcmlvdGlvbiA9IHRoaXMucHJveHkkLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChlKSA9PiB7XG4gICAgICAgICAgb3ZzZXJ2ZXIubmV4dChlKTtcblxuICAgICAgICAgIGlmIChlLnR5cGUgJiYgZS50eXBlID09PSAnZW5kJykge1xuICAgICAgICAgICAgdGhpcy5pbnRlcm5hbC5zdG9wKCk7XG4gICAgICAgICAgICBvdnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgc3Vic2NyaW90aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogKGUpID0+IG92c2VydmVyLmVycm9yKGUpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNwZWVjaCBSZWNvZ25pdGlvbiBzdGFydFxuICAgICAgdGhpcy5pbnRlcm5hbC5zdGFydCgpO1xuXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICB0aGlzLmludGVybmFsLmFib3J0KCk7XG4gICAgICAgIHN1YnNjcmlvdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJldHVybiBsaXN0ZW5lcjtcbiAgfVxuXG59XG4iXX0=